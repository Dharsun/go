import zipfile
import re

def search_in_zip(zip_file_path, keyword_pattern):
    with zipfile.ZipFile(zip_file_path, 'r') as zip_ref:
        matched_files = {}

        for file_info in zip_ref.infolist():
            with zip_ref.open(file_info) as file:
                content = file.read().decode('utf-8', errors='ignore')
                matches = re.findall(keyword_pattern, content)
                if matches:
                    if file_info.filename not in matched_files:
                        matched_files[file_info.filename] = matches
                    else:
                        matched_files[file_info.filename].extend(keyword for keyword in matches if keyword not in matched_files[file_info.filename])

        return matched_files

def write_to_html(output_file, matched_files):
    with open(output_file, 'w') as f:
        f.write("<html><body>")
        f.write("<h2>Matched Keywords in Zip Archive</h2>")
        
        if matched_files:
            for file_name, keywords in matched_files.items():
                f.write(f"<h3>{file_name}</h3>")
                f.write("<ul>")
                for keyword in keywords:
                    f.write(f"<li>{keyword}</li>")
                f.write("</ul>")
        else:
            f.write("<p>No matches found.</p>")
        
        f.write("</body></html>")

if __name__ == "__main__":
    zip_file_path = 'path/to/your/archive.zip'
    keyword_pattern = r'your_regex_pattern_here'
    output_html_file = 'output.html'

    matched_files = search_in_zip(zip_file_path, keyword_pattern)

    if matched_files:
        print("Keyword found in the following files:")
        for file_name in matched_files:
            print(file_name)
    else:
        print("Keyword not found in any files.")

    write_to_html(output_html_file, matched_files)
